<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Nagios Plugin LCG SAM : Service Availability Monitoring for LCG sites" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Nagios Plugin LCG SAM</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/jcasals/nagios-plugins-lcgsam">View on GitHub</a>

          <h1 id="project_title">Nagios Plugin LCG SAM</h1>
          <h2 id="project_tagline">Service Availability Monitoring for LCG sites</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/jcasals/nagios-plugins-lcgsam/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/jcasals/nagios-plugins-lcgsam/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="nagios-plugin-for-lcg-sam" class="anchor" href="#nagios-plugin-for-lcg-sam"><span class="octicon octicon-link"></span></a>Nagios Plugin for LCG SAM</h1>

<h3>
<a name="overview" class="anchor" href="#overview"><span class="octicon octicon-link"></span></a>Overview</h3>

<p>This is a Nagios plugin to check Service Availability Monitoring required test for <a href="http://wlcg.web.cern.ch/">LCG</a> (LHC Computing Grid) sites.</p>

<p>This check uses the dashboard data for every project based on the Nagios Site Usability tests (SUM).</p>

<h3>
<a name="authors" class="anchor" href="#authors"><span class="octicon octicon-link"></span></a>Authors</h3>

<p>Mindcrafted by Pablo Saiz (CERN) and Pepe Flix (<a href="www.pic.es">PIC</a>). Handcrafted by Jordi Casals (<a href="www.pic.es">PIC</a>).</p>

<p>Contact: jcasals (at) pic (dot) es</p>

<h3>
<a name="requirements" class="anchor" href="#requirements"><span class="octicon octicon-link"></span></a>Requirements</h3>

<p>It consists on a Bash script and the only requirement is to have <a href="http://stedolan.github.io/jq/">JQ</a>, a simple and flexible JSON processor for bash.</p>

<h3>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h3>

<p>You just have to install it via RPM and, if you don't have JQ on your server, it will install it as requirement.</p>

<pre><code>$ yum install nagios-plugins-lcgsam
</code></pre>

<h3>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h3>

<pre><code>$ /usr/lib64/nagios/plugins/check_lcgsam -v &lt;vo&gt; -p &lt;profile&gt; -s &lt;site&gt; [-f &lt;flavour1[,flavour2,...]&gt;]
</code></pre>

<p>As you can see it has four parameters. </p>

<ul>
<li>vo (-v), profile (-p) and site (-s) are mandatory. </li>
<li>flavour (-f) is optional. You can specify multiple flavours, one, or none. If you specify no flavour, this will return all flavours for this vo, profile and site combination.</li>
</ul><p>You can see an example of how it works by running it on your command line:</p>

<pre><code>$ /usr/lib64/nagios/plugins/check_lcgsam -v atlas -p ATLAS_CRITICAL -s pic -f CREAM-CE,SRMv2
CREAM-CE: OK // SRMv2: OK

HOSTS
======
CREAM-CE
ce07.pic.es: OK
ce08.pic.es: OK
ce09.pic.es: OK
ce10.pic.es: OK
ce11.pic.es: OK
SRMv2
srmatlas.pic.es: OK

All hosts in flavour/s CREAM-CE,SRMv2 OK!
</code></pre>

<h3>
<a name="setup-for-nagios" class="anchor" href="#setup-for-nagios"><span class="octicon octicon-link"></span></a>Setup for Nagios</h3>

<p>To add the plugin to your Nagios System you just have to create a command as you usually do with other plugins. A sample of command line input on the NagiosQL setup can be:</p>

<pre><code>$USER1$/check_lcgsam -v $ARG1$ -p $ARG2$ -s $ARG3$ -f $ARG4$
</code></pre>

<p>Or if you prefer, you can create this command on your commands</p>

<pre><code>define command {
    command_name    check_lcgsam
    command_line    $USER1$/check_lcgsam -v $ARG1$ -p $ARG2$ -s $ARG3$ -f $ARG4$
}
</code></pre>

<h3>
<a name="optional-setup-for-nagios" class="anchor" href="#optional-setup-for-nagios"><span class="octicon octicon-link"></span></a>Optional Setup for Nagios</h3>

<p>We tried to add a little more information to the Nagios output, so we added the option to have a link that points out to the error information, in case there is an error. For some reason (we can imagine it's for security) there are some characters not admitted, and in addition the HTML is disabled in the output. To change this you have to modify two files.</p>

<p><strong>/usr/local/nagios/etc/cgi.cfg</strong> <em>or your equivalent cgi.cfg</em></p>

<pre><code># escape_html_tags=1
escape_html_tags=0
</code></pre>

<p><strong>/usr/local/nagios/etc/nagios.cfg</strong> <em>or your equivalent nagios.cfg or icinga.cfg</em></p>

<pre><code># illegal_object_name_chars=`~!$%^&amp;*|'"&lt;&gt;?,()=
illegal_object_name_chars=`~!$%^&amp;*|'"?,()=
</code></pre>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Nagios Plugin LCG SAM maintained by <a href="https://github.com/jcasals">jcasals</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
